##Biblioteki install.packages("summarytools")


```{r setup1, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
options(qwraps2_markup = "markdown")
library(qwraps2)
library(arsenal)
library(e1071)
library(haven)
library(papeR)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(kableExtra)
library(summarytools)
library(classInt)
library(pastecs)
library(desctable)
library(frequency)
library(corrplot)
library(ggpubr)
download.file("https://github.com/kflisikowski/ds/blob/master/data_apartments.csv?raw=true", destfile ="mieszkania.csv",mode="wb")
mieszkania <- read.csv("mieszkania.csv",sep=";",dec=",")
```

---
title: "Analiza_Danych_Projekt_Markdown"
author: "MŁ"
date: "2025-01-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r}
apartments <- read_csv("apartments_pl_2024_06.csv")
# Calculate the percentage of missing data for each column
missing_percentage <- sapply(apartments, function(x) mean(is.na(x)) * 100)

# Create a data frame to display the results
missing_data_summary <- data.frame(
  Variable = names(missing_percentage),
  Missing_Percentage = missing_percentage
)

# Display the result sorted by percentage of missing data
missing_data_summary <- missing_data_summary %>%
  arrange(desc(Missing_Percentage))

# Print the summary
print(missing_data_summary)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

<<<<<<< HEAD
```{r setup, include=FALSE}
##Poprawa błędów (kod niżej)
str(apartments)
summary(apartments$district)
table(apartments$district)
apartments$district <- as.factor(apartments$district)
apartments$district <- factor(c("district1", "district2", "district3", ...))
apartments$district <- factor(rep("Unknown", nrow(apartments)))
colnames(apartments)
apartments$district <- factor(ifelse(apartments$city == "Wrocław", "Wrocław", "Inne"))
apartments$district <- factor(rep(NA, nrow(apartments)))
```





## Data wrangling
```{r wrangling, include=TRUE}

apartments$building_type<-as.factor(apartments$buildYear)
apartments$rooms<-factor(apartments$rooms,ordered=TRUE)
attach(apartments)
apartments$price<-as.numeric(apartments$price)

```





## Tabele liczności oraz TAI

```{r table, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# Granice przedziałów co 300000, od 190000 do 3000000
limits <- seq(190000, 3000000, by = 300000)

# Generowanie etykiet w formacie "190000-490000 PLN", "490000-790000 PLN", itd.
etykiety <- paste(limits[-length(limits)], limits[-1] - 1, "PLN", sep = "-")

# Dodajemy etykietę dla ostatniego przedziału, aby kończył się na 3000000
etykiety[length(etykiety)] <- paste(limits[length(limits)] - 300000, "3000000 PLN", sep="-")

# Tworzymy przedziały przy pomocy 'cut' i dopasowujemy etykiety
limits_cut <- cut(apartments$price, breaks = limits, labels = etykiety, right = FALSE, include.lowest = TRUE)

# Tworzymy tabelę z frekwencją (w HTML)
tabela1 <- freq(limits_cut, type = "html")

# Wyświetlanie wyników
tabela1


```
  
```{r}

library(ggplot2)
library(scales)
library(dplyr)
###Dodajemy "czyste"




# Compute percentages within each city group
apartments_pct <- czyste %>%
  group_by(city, condition) %>%
  summarise(count = n(), .groups = "drop") %>%
  mutate(percentage = count / sum(count))  # Calculate percentage

# Define color palette
colors <- RColorBrewer::brewer.pal(8, "Set2")  

ggplot(apartments_pct, aes(x = condition, y = percentage, fill = condition)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = scales::percent(percentage, accuracy = 1)), 
            y = 0.1,  # Fixed height (10%) for all labels
            color = "black", size = 5) +  
  facet_wrap(~ city) +  
  theme_minimal() +
  scale_y_continuous(labels = percent_format(), limits = c(0, 0.2)) +  # Limit Y-axis to 20%
  scale_fill_manual(values = colors) +  
  labs(title = "Condition Distribution Across Cities", x = "Condition", y = "Percentage")

```

```{r}
# aov and interaction plot
# Using aov to assess interaction effects between variables
aov <- aov(price ~ city * condition, data = apartments)
summary(aov)

# Interaction plot
interaction.plot(
  czyste$city,
  czyste$condition,
  czyste$price,
  main = "Interaction Plot: City x Condition",
  xlab = "City",
  ylab = "Average Price",
  col = 1:6
)
>>>>>>> d1e3609dc246b872a6562d5ec7f6ee16036eb488


```

<<<<<<< HEAD



```{r tai, echo=FALSE}
kbl(tabela1,caption = "Mieszkania we Wrocławiu- ceny w PLN") %>%
    kable_material(c("striped", "hover"))
tab1<-classIntervals(apartments$price,n=10,style="fixed",fixedBreaks=seq(190000,3100000,by=100000))
jenks.tests(tab1)
```


=======
```{r}
corrplot(correlation_matrix, method = "square", 
         tl.cex = 0.8, cl.cex = 0.8, 
         type = "upper", order = "hclust", 
         addCoef.col = "black", number.cex = 0.7,
         title = "Correlation Heatmap for Selected Variables", mar = c(0, 0, 2, 0))
```

```{r}
ggplot(czyste, aes(x = condition, y = price, fill = condition)) +
  geom_violin(alpha = 0.8) +
  theme_minimal() +
  labs(title = "Impact of Apartment Condition on Prices", x = "Condition", y = "Price")
czyste %>%
  group_by(condition) %>%
  summarise(
    count = n(),
    mean_price = mean(price, na.rm = TRUE),
    median_price = median(price, na.rm = TRUE),
    min_price = min(price, na.rm = TRUE),
    max_price = max(price, na.rm = TRUE),
    sd_price = sd(price, na.rm = TRUE)  # Standard deviation for variability
  )

```

```{r}
ggplot(czyste, aes(x = floor)) +
  geom_histogram(binwidth = 1, fill = "blue", alpha = 0.7) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(czyste$floor, na.rm = TRUE), 
                                  max(czyste$floor, na.rm = TRUE), 
                                  by = 1)) 
  labs(title = "Distribution of Apartments by Floor", x = "Floor", y = "Count")


```

```{r}
# Select relevant POI variables + price
poi_vars <- c("schoolDistance", "clinicDistance", "postOfficeDistance", "kindergartenDistance", 
              "restaurantDistance", "collegeDistance", "pharmacyDistance", "centreDistance", "price")

poi_correlation <- cor(czyste %>% select(all_of(poi_vars)), use = "pairwise.complete.obs")

# Plot correlation heatmap
corrplot(poi_correlation, method = "square", tl.cex = 0.8, cl.cex = 0.8, 
         type = "upper", order = "hclust", addCoef.col = "black", 
         number.cex = 0.7, title = "POI Distance Correlations with Price", mar = c(0, 0, 2, 0))

```

```{r}
ggplot(czyste, aes(x = buildingMaterial, y = price, fill = buildingMaterial)) +
  geom_boxplot(alpha = 0.8) +
  theme_minimal() +
  coord_flip() +
  labs(title = "Impact of Building Material on Price", x = "Building Material", y = "Price")
```

```{r}
czyste %>%
  group_by(city) %>%
  summarise(avg_size = mean(squareMeters, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(city, avg_size), y = avg_size, fill = city)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Average Apartment Size by City", x = "City", y = "Average Square Meters")

```

```{r}
ggplot(czyste, aes(x = centreDistance, y = price)) +
  geom_point(aes(color = city), alpha = 0.5) +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  theme_minimal() +
  labs(title = "Effect of Distance from Center on Price", x = "Distance from City Center (km)", y = "Price")

```

```{r}
ggplot(czyste, aes(x = factor(hasSecurity, labels = c("No Security", "Has Security")), y = price)) +
  geom_boxplot(aes(fill = factor(hasSecurity)), alpha = 0.8) +
  theme_minimal() +
  labs(title = "Impact of Security on Apartment Prices", x = "Security", y = "Price") +
  scale_fill_manual(values = c("red", "green"))
czyste %>%
  group_by(hasSecurity) %>%
  summarise(
    count = n(),
    mean_price = mean(price, na.rm = TRUE),
    median_price = median(price, na.rm = TRUE),
    min_price = min(price, na.rm = TRUE),
    max_price = max(price, na.rm = TRUE),
    sd_price = sd(price, na.rm = TRUE)  # Standard deviation for variability
  )


```

```{r}
library(corrplot)

correlation_analysis <- function(data) {
  # Ensure the selected columns exist in the dataset
  required_columns <- c("price", "poiCount", "squareMeters", "rooms")
  
  if (!all(required_columns %in% names(data))) {
    stop("One or more required columns are missing from the dataset.")
  }
  
  # Compute correlation values
  cor_matrix <- cor(data[, required_columns], use = "pairwise.complete.obs")
  
  # Create the correlation heatmap
  corrplot(cor_matrix, 
           method = "color", 
           col = colorRampPalette(c("orange", "white", "navy"))(200), 
           type = "upper", 
           order = "hclust", 
           addCoef.col = "black", 
           tl.col = "black", 
           tl.srt = 45, 
           title = "Correlation Heatmap")
}

# Usage example:
correlation_analysis(czyste)

```

```{r}
# Calculate the count and percentage of each building type
type_summary <- czyste %>%
  count(type) %>%
  mutate(percentage = n / sum(n) * 100)

# Create a bar plot to show the count and percentage of each building type with fixed bar height
ggplot(type_summary, aes(x = type, y = n)) +
  geom_bar(stat = "identity", fill = "steelblue", color = "black", width = 0.7) +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            vjust = 0.5, hjust = 0.5, size = 5, color = "black") +  # Center the percentage
  theme_minimal() +
  labs(title = "Distribution of Building Types", x = "Building Type", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
# Load the scales package for formatting numbers
library(scales)

# Calculate the average price for each building type
average_price_by_type <- czyste %>%
  group_by(type) %>%
  summarise(avg_price = mean(price, na.rm = TRUE))

# Create a bar plot to visualize the average price by building type with currency formatting
ggplot(average_price_by_type, aes(x = type, y = avg_price, fill = type)) +
  geom_bar(stat = "identity", color = "black") +
  scale_y_continuous(labels = scales::comma_format(big.mark = ".", decimal.mark = ",")) +  # Currency format
  theme_minimal() +
  labs(title = "Average Price by Building Type", x = "Building Type", y = "Average Price") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate the x-axis labels if needed
  geom_text(aes(label = scales::comma(avg_price, big.mark = ".", decimal.mark = ",")), 
            position = position_stack(vjust = 0.5), color = "white", fontface = "bold")

```
>>>>>>> d1e3609dc246b872a6562d5ec7f6ee16036eb488













