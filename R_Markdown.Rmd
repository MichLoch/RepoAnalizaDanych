---
title: "Raport"
author: "Michał Łochowski, Paweł Górdak, Dawid Drawc"
date: "`r format(Sys.Date(), '%d.%m.%Y')`"
output:
  rmdformats::downcute:
    self_contained: true
    thumbnails: true
    lightbox: true
    gallery: false
    highlight: tango
---

# Wprowadzenie

## Cel Raportu

Celem tego raportu jest analiza zbioru danych **apartaments_pl_2024_06**.  
Aby to osiągnąć, dane zostaną oczyszczone, brakujące wartości uzupełnione, a następnie przeprowadzona zostanie analiza wraz z wizualizacją wyników.  

## Przegląd zbioru danych  

Zbiór danych **apartaments_pl_2024_06** zawiera informacje o rynku nieruchomości w największych miastach Polski.  
Koncentruje się na cenach nieruchomości, wielkości mieszkań, bliskości infrastruktury miejskiej oraz roku budowy.  

## Zmienne w zbiorze danych aparaments_pl_2024_06  

Zbiór danych zawiera następujące zmienne:  

#### Zmienne opisujące lokalizację mieszkania:  

**id** – Unikalny identyfikator każdej nieruchomości generowany komputerowo  

**city** – Miasto, w którym znajduje się nieruchomość  

**latitude** – Szerokość geograficzna  

**longitude** – Długość geograficzna  

#### Zmienne opisujące cenę i status własności nieruchomości:  

**price** – Cena nieruchomości  

**ownership** – Status własności nieruchomości  

#### Zmienne opisujące typ i wielkość mieszkania:  

**type** – Typ budynku: blok mieszkalny, apartamentowiec, kamienica  

**buildingMaterial** – Materiał użyty do budowy budynku  

**condition** – Aktualny stan nieruchomości  

**squareMeters** – Całkowita powierzchnia nieruchomości (w metrach kwadratowych)  

**rooms** – Liczba pokoi w nieruchomości  

**floor** – Piętro, na którym znajduje się nieruchomość  

**floor count** – Całkowita liczba pięter w budynku  

#### Zmienne opisujące odległość od kluczowych udogodnień w mieście:  

**centreDistance** – Odległość od centrum miasta  

**poiCount** – Liczba punktów użyteczności publicznej w pobliżu nieruchomości  

**schoolDistance** – Odległość do najbliższej szkoły  

**clinicDistance** – Odległość do najbliższej przychodni medycznej  

**postOfficeDistance** – Odległość do najbliższej poczty  

**kindergartenDistance** – Odległość do najbliższego przedszkola  

**restaurantDistance** – Odległość do najbliższej restauracji  

**collegeDistance** – Odległość do najbliższego college’u/uniwersytetu  

**pharmacyDistance** – Odległość do najbliższej apteki  

#### Zmienne opisujące, czy nieruchomość lub budynek, w którym się znajduje, obejmuje określoną infrastrukturę:  

**hasParkingSpace** – Czy nieruchomość posiada miejsce parkingowe (Tak/Nie)  

**hasBalcony** – Czy nieruchomość posiada balkon (Tak/Nie)  

**hasElevator** – Czy budynek posiada windę (Tak/Nie)  

**hasSecurity** – Czy nieruchomość/budynek posiada zabezpieczenia (Tak/Nie)  

**hasStorageRoom** – Czy nieruchomość posiada pomieszczenie gospodarcze (Tak/Nie)  

## Czyszczenie i przetwarzanie danych  

#### Installation of needed libraries and data

```{r setup1, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
options(repos = c(CRAN = "https://cran.rstudio.com"))
options(qwraps2_markup = "markdown")

library(e1071)
install.packages("naniar")  
library(naniar)    
install.packages("VIM")
library(VIM)
install.packages("mice")
library(mice)
library(haven)
library(frequency)
library(corrplot)
library(ggpubr) 
library(ggplot2)
library(scales)
library(dplyr) 
library(corrplot) 
library(moments)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(kableExtra)
install.packages("validate")
library(validate)
if (!require("qwraps2")) install.packages("qwraps2")
library(qwraps2)
if (!require("DMwR")) install.packages("DMwR")
library(DMwR)
if (!require("outliers")) library(outliers)
library(outliers)
if (!require("arsenal")) install.packages("arsenal")
library(arsenal)
if (!require("papeR")) install.packages("papeR")
library(papeR)
if (!require("summarytools")) install.packages("summarytools")
library(summarytools)
if (!require("classInt")) install.packages("classInt")
library(classInt)
if (!require("pastecs")) install.packages("pastecs")
library(pastecs)
if (!require("desctable")) install.packages("desctable")
library(desctable)
if (!require("frequency")) install.packages("frequency")
#data reading
apartments <- read_csv("apartments_pl_2024_06.csv")

```

#### Visualizing the missing data using missing-data map

```{r visualize-missing-data, echo=TRUE, message=FALSE, warning=FALSE}
# Missing Data Map
vis_miss(apartments)

# UpSet plot for missing data
library(naniar)
gg_miss_upset(apartments, nsets = 3)
```

Otrzymany wykres pokazuje, że brakujące dane w zbiorze stanowią około 6,3% wszystkich danych. Większość brakujących wartości pochodzi z zmiennej condition, której braki wynoszą 74%, oraz **material**, gdzie braki sięgają 41%. Znaczące deficyty danych można również zauważyć w zmiennych: **type**, **floor** oraz **buildYear**, które zawierają odpowiednio 20%, 17% i 16% brakujących wartości.

Brakujące dane w zbiorze mogą wynikać z kilku czynników. Wysoki odsetek brakujących wartości w zmiennych condition i buildingMaterial sugeruje, że takie informacje często nie są ujawniane przez właścicieli nieruchomości lub w ogłoszeniach na portalach. Podobnie, luki w zmiennych **type**, **floor** i **buildYear** mogą wynikać z niekompletnych zapisów dotyczących starszych nieruchomości lub niespójności w sposobie raportowania danych w różnych miastach. Braki w **floor** mogą być również związane z nieruchomościami oznaczonymi jako domy lub mieszkania na parterze, gdzie ta informacja nie jest istotna. W niektórych przypadkach szczegóły dotyczące nieruchomości mogą być celowo pomijane przez sprzedających, aby zwiększyć atrakcyjność ogłoszenia lub z powodu braku dokładnych informacji. Dodatkowo, metody zbierania danych – takie jak web scraping z portali nieruchomości – mogą przyczyniać się do brakujących wartości, jeśli niektóre szczegóły nie są konsekwentnie udostępniane na różnych platformach.


```{r}
str(apartments)

# Wybór zmiennych numerycznych do analizy
numeric_cols <- apartments %>% select(where(is.numeric))

# Metoda 1: Wykrywanie wartości odstających metodą IQR
find_outliers_iqr <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR
  upper_bound <- Q3 + 1.5 * IQR
  return(which(x < lower_bound | x > upper_bound))
}

outliers_iqr <- lapply(numeric_cols, find_outliers_iqr)
```
```{r}
# Wybór tylko zmiennych numerycznych
numeric_cols <- apartments %>% select(where(is.numeric))

# Funkcja do wykrywania wartości odstających metodą IQR
find_outliers_iqr <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR
  upper_bound <- Q3 + 1.5 * IQR
  return(which(x < lower_bound | x > upper_bound))  # Zwraca indeksy wartości odstających
}

# Znalezienie wartości odstających dla wszystkich zmiennych numerycznych
outliers_iqr <- lapply(numeric_cols, find_outliers_iqr)

# Wizualizacja wartości odstających za pomocą boxplotów dla każdej zmiennej numerycznej
par(mfrow = c(3, 3))  # Układ wykresów (3x3)
for (col in colnames(numeric_cols)) {
  boxplot(numeric_cols[[col]], main = col, col = "lightblue", border = "red", outline = TRUE)
}
par(mfrow = c(1, 1))  # Powrót do domyślnego układu wykresów
```
W Wyniku analizy zbioru danych, możemy zobaczyć, że dane apartments_pl_2024_06 zawierają wiele wartości odstających. Wartości odstające, możemy zaobserwować dla niemal wszystkich zmiennych. Szczególnymi przykładami może być zmienne: Price, collegeDistance oraz Centre Distance.

### Zastępowanie wartości odstających medianą

```{r}
# Lista zmiennych związanych z odległościami (distance)
distance_vars <- c("centreDistance", "schoolDistance", "clinicDistance", 
                   "postOfficeDistance", "kindergartenDistance", 
                   "restaurantDistance", "collegeDistance", "pharmacyDistance")

# Funkcja do zastępowania wartości odstających medianą (dla zmiennych numerycznych poza distance_vars)
replace_outliers_with_median <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR
  upper_bound <- Q3 + 1.5 * IQR
  
  # Zastąp wartości odstające medianą
  x[x < lower_bound | x > upper_bound] <- median(x, na.rm = TRUE)
  return(x)
}

# Tworzenie nowego zbioru danych apartments2
apartments2 <- apartments

# Przetwarzanie zmiennych numerycznych z wyłączeniem distance_vars
for (col in names(numeric_cols)) {
  if (!(col %in% distance_vars)) {
    apartments2[[col]] <- replace_outliers_with_median(apartments[[col]])
  }
}

# Sprawdzenie pierwszych kilku wierszy w nowym zbiorze danych
head(apartments2)

# Porównanie statystyk przed i po przetwarzaniu
cat("Statystyki dla pierwotnego zbioru danych:\n")
summary(apartments)

cat("\nStatystyki dla przetworzonego zbioru danych (apartments2):\n")
summary(apartments2)
```

#### Wypełnianie brakujących danych używając funkcji hotdeck

```{r}
 
#Używanie funkcji hotdeck do wypełnienia brakujących danych
czyste <- hotdeck(apartments2)

n_miss(czyste)  # Count of NA values: 0
n_complete(czyste)  # Count of complete values: 1204056
pct_miss(czyste)  # Percentage of NA values: [1] 0


```

## The core of the analysis

The key variable to analyse within the data-set is price as it describes the situation on the polish housing market which the data-set is based on.

```{r}
descriptive_stats <- czyste %>%
  select(price) %>%
  summarise(
    Mean = format(mean(price, na.rm = TRUE), big.mark = ".", scientific = FALSE, digits = 0),
    Median = format(median(price, na.rm = TRUE), big.mark = ".", scientific = FALSE, digits = 0),
    Std_Dev = format(sd(price, na.rm = TRUE), big.mark = ".", scientific = FALSE, digits = 0),
    Min = format(min(price, na.rm = TRUE), big.mark = ".", scientific = FALSE, digits = 0),
    Max = format(max(price, na.rm = TRUE), big.mark = ".", scientific = FALSE, digits = 0),
  
  )

# Print the results
print(descriptive_stats)
skew_value <- skewness(czyste$price, na.rm = TRUE)
kurt_value <- kurtosis(czyste$price, na.rm = TRUE)

print(paste("Skewness: ", skew_value))
print(paste("Kurtosis: ", kurt_value))
```

Wyniki skośności wskazują, że dane zawierają niektóre wartości odstające o wysokich cenach, a nieruchomości o niskiej cenie są bardziej skoncentrowane. Kurtoza na poziomie 7,12 wskazuje na dużą liczbę wartości odstających w zbiorze danych.

#### Aby przeanalizować stan polskiego rynku mieszkaniowego, apartamenty zostały pogrupowane w przedziały cenowe:

```{r}
limits <- c(0, 250000, 500000, 750000, 1000000, 1250000, Inf)

# Generate labels
labels <- c(
  "<250,000 PLN", 
  "250,000 - 499,999 PLN", 
  "500,000 - 749,999 PLN", 
  "750,000 - 999,999 PLN", 
  "1,000,000 - 1,249,999 PLN", 
  "≥1,250,000 PLN"
)

# Categorize apartment prices into bins
czyste$price_category <- cut(
  czyste$price, 
  breaks = limits, 
  labels = labels, 
  include.lowest = TRUE, 
  right = FALSE
)

# Create binary columns for each price category
for (i in 1:length(labels)) {
  czyste[paste0("in_range_", i)] <- ifelse(czyste$price_category == labels[i], 1, 0)
}

# Count occurrences and calculate percentages
price_counts <- czyste %>%
  count(price_category) %>%
  mutate(percentage = n / sum(n) * 100)  # Convert counts to percentages

# Define fixed label height (adjust based on dataset)
fixed_label_height <- max(price_counts$n) * 1.05  # Slightly above max count for visibility

# Plot the distribution of apartment prices
ggplot(price_counts, aes(x = price_category, y = n, fill = price_category)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            vjust = 2, 
            size = 5, 
            color = "black",
            nudge_y = fixed_label_height - max(price_counts$n)) +  # Fixed height
  scale_y_continuous(labels = scales::comma) +  # Format Y-axis with thousands separator
  theme_minimal() +
  labs(
    title = "Distribution of Apartment Prices",
    x = "Price Range",
    y = "Count of Apartments"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate labels for readability

```

Wizualizacja pokazuje, w jakich przedziałach cenowych znajdują się apartamenty w zbiorze danych. Największy klaster apartamentów znajduje się w przedziale cenowym od 500 000 do 749 999 PLN, który obejmuje 33,9% obserwacji. Kolejne dwie kategorie z największą liczbą obserwacji to 750 000 do 999 999 PLN (24,7%) oraz 250 000 do 499 999 PLN (18,5%). Łącznie stanowią one 77,1% obserwacji.

Poprzednia hipoteza o dużej liczbie wartości odstających została potwierdzona, ponieważ 13,2% nieruchomości ma cenę powyżej 1 250 000 PLN. Jednak sama ta wartość nie uzasadnia dużej kurtozy; w tym przedziale cenowym muszą występować również silne wartości odstające. Aby to sprawdzić, tworzony jest wykres pudełkowy.

```{r}
###Visualisation of Price Distribution by City
ggplot(czyste, aes(x = city, y = price)) +  
  geom_boxplot(aes(fill = city), alpha = 0.85) +  
  theme_minimal() +  
  labs(title = "Price Distribution by City", x = NULL, y = "Price") +   
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +  
  scale_y_continuous(labels = scales::label_number(big.mark = ".", decimal.mark = ","))  
```

```{r}
# Zlicz wystąpienia i oblicz procentowy udział dla zmiennej 'ownership'
ownership_counts <- czyste %>%
  count(ownership) %>%
  mutate(percentage = n / sum(n) * 100)  # Convert counts to percentages

# Ustal stałą wysokość etykiet (dostosuj w zależności od zbioru danych)
fixed_label_height <- max(ownership_counts$n) * 1.05  # Slightly above max count for visibility

# Wizualizuj rozkład własności ('ownership')
ggplot(ownership_counts, aes(x = ownership, y = n, fill = ownership)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            vjust = 2, 
            size = 5, 
            color = "black",
            nudge_y = fixed_label_height - max(ownership_counts$n)) +  # Fixed height
  scale_y_continuous(labels = scales::comma) +  # Format Y-axis with thousands separator
  theme_minimal() +
  labs(
    title = "Distribution of Ownership",
    x = "Ownership",
    y = "Count of Apartments"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate labels for readability

```

89,7% Własność kondominium: Dominacja kondominiów sugeruje, że większość osób w zbiorze danych posiada swoje mieszkania jako indywidualne jednostki z osobistym tytułem własności. Jest to zgodne z bardziej rynkowym modelem mieszkalnictwa, w którym podkreśla się prywatną własność, a właściciele mają pełną kontrolę nad swoimi lokalami.

10,3% Własność spółdzielcza: Mniejszy odsetek osób mieszka w lokalach spółdzielczych, co wskazuje, że choć nadal istotna, ta forma własności jest mniej powszechna. Własność spółdzielcza jest często bardziej regulowana i może ograniczać pewne swobody, takie jak możliwość swobodnej sprzedaży lub wynajmu lokalu.

Blisko 0% Własność udziałowa: Znikoma obecność opcji „udział” sugeruje, że ta forma własności jest rzadka lub może zanikać na polskim rynku mieszkaniowym. Może to wskazywać na odchodzenie od starszych, zbiorowych struktur własnościowych.

```{r}
# aov and interaction plot
# Using aov to assess interaction effects between variables
aov <- aov(price ~ city * condition, data = czyste)
summary(aov)

# Ensure 'city' is treated as a factor (if not already)
czyste$city <- factor(czyste$city)

# Interaction plot
interaction.plot(
  czyste$city,
  czyste$condition,
  czyste$price,
  main = "Interaction Plot: City x Condition",
  xlab = "City",
  ylab = "Average Price",
  col = 1:length(unique(czyste$city)), # Dynamic coloring based on number of cities
  las = 2, # Rotate labels on x-axis for better readability
  cex.axis = 0.7, # Adjust axis label size if needed
  cex.lab = 1.2 # Adjust label size if needed
)

```

Wykres przedstawia średnią cenę mieszkania w każdym mieście w zależności od jego stanu.

### Analiza mapy cieplnej

```{r}
# Compute correlation matrix for selected variables
correlation_matrix <- cor(czyste %>% select(price, poiCount, squareMeters, rooms), 
                          use = "pairwise.complete.obs")

# Plot correlation heatmap for key apartment features
corrplot(correlation_matrix, method = "square", 
         tl.cex = 0.8, cl.cex = 0.8, 
         type = "upper", order = "hclust", 
         addCoef.col = "black", number.cex = 0.7,
         title = "Correlation Heatmap for Selected Variables", mar = c(0, 0, 2, 0)) 

# Define relevant POI variables
poi_vars <- c("schoolDistance", "clinicDistance", "postOfficeDistance", 
              "kindergartenDistance", "restaurantDistance", "collegeDistance", 
              "pharmacyDistance", "centreDistance", "price")

# Ensure all selected variables exist in the dataset
existing_poi_vars <- poi_vars[poi_vars %in% colnames(czyste)]

# Compute correlation matrix for POI distances and price
poi_correlation <- cor(czyste %>% select(all_of(existing_poi_vars)), 
                       use = "pairwise.complete.obs")

# Plot POI correlation heatmap
corrplot(poi_correlation, method = "square", 
         tl.cex = 0.8, cl.cex = 0.8, 
         type = "upper", order = "hclust", 
         addCoef.col = "black", number.cex = 0.7,
         title = "POI Distance Correlations with Price", mar = c(0, 0, 2, 0)) 

# Define correlation analysis function
correlation_analysis <- function(data) {
  required_columns <- c("price", "poiCount", "squareMeters", "rooms")
  
  # Ensure required columns exist
  existing_columns <- required_columns[required_columns %in% names(data)]
  
  if (length(existing_columns) < length(required_columns)) {
    stop("One or more required columns are missing from the dataset.")
  }
  
  # Compute correlation values
  cor_matrix <- cor(data[, existing_columns], use = "pairwise.complete.obs")
  
  # Create correlation heatmap
  corrplot(cor_matrix, 
           method = "color", 
           col = colorRampPalette(c("orange", "white", "navy"))(200), 
           type = "upper", 
           order = "hclust", 
           addCoef.col = "black", 
           tl.col = "black", 
           tl.srt = 45, 
           title = "Correlation Heatmap")
}

# Execute correlation analysis
correlation_analysis(czyste)

```

Analiza mapy cieplnej korelacji między różnymi zmiennymi prowadzi do trzech wykresów:

Pierwszy wykres przedstawia korelację między wybranymi zmiennymi, takimi jak szerokość geograficzna, cena, metraż, liczba pokoi, piętro, liczba pięter w budynku, długość geograficzna, rok budowy oraz odległość od centrum. Wykazuje on niewielką lub żadną korelację między większością z tych zmiennych.

Druga mapa cieplna przedstawia korelację między mieszkaniem a odległością do różnych udogodnień. Pokazuje ona, że zazwyczaj, jeśli mieszkanie znajduje się blisko jednej infrastruktury, to jest także blisko innej. Co jednak ciekawe, istnieje negatywna korelacja między ceną a odległością do kliniki oraz restauracji, co wskazuje, że im mniejsza odległość, tym wyższa cena mieszkania. Jest to szczególnie nietypowe w kontekście pozytywnej korelacji między ceną a odległością do centrum, co sugeruje, że im bliżej centrum znajduje się mieszkanie, tym jest tańsze. Wynik ten stoi w sprzeczności z intuicyjną hipotezą, że mieszkania w centrum miasta są najdroższe. Może to oznaczać, że w danych znajduje się znaczna liczba mieszkań na przedmieściach, które są warte więcej niż mieszkania w obszarach miejskich.

Trzeci wykres przedstawia mapę cieplną mierzącą cenę w odniesieniu do liczby pokoi oraz powierzchni mieszkania. Naturalna hipoteza, że większe mieszkania i większa liczba pokoi oznaczają wyższą cenę, znajduje potwierdzenie, wykazując bardzo wysoką dodatnią korelację.

Następnie tworzony jest wykres analizujący wpływ piętra, na którym znajduje się mieszkanie, na jego cenę.

```{r}
ggplot(czyste, aes(x = floor)) +
  geom_histogram(binwidth = 1, fill = "blue", alpha = 0.7) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(czyste$floor, na.rm = TRUE), 
                                  max(czyste$floor, na.rm = TRUE), 
                                  by = 1)) 
  labs(title = "Distribution of Apartments by Floor", x = "Floor", y = "Count")



```

Wykres pokazuje, że większość mieszkań znajduje się na niższych piętrach oraz że ogólnie liczba budynków mających mniej niż 5 pięter jest większa, co sugeruje, że większość budynków jest raczej niewielka.

##### Analizę pięter można lepiej zrozumieć poprzez analizę typów budynków w badanej populacji.

```{r}
# Calculate the count and percentage of each building type
type_summary <- czyste %>%
  count(type) %>%
  mutate(percentage = n / sum(n) * 100)

# Create a bar plot to show the count and percentage of each building type with fixed bar height
ggplot(type_summary, aes(x = type, y = n)) +
  geom_bar(stat = "identity", fill = "steelblue", color = "black", width = 0.7) +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            vjust = 0.5, hjust = 0.5, size = 5, color = "black") +  # Center the percentage
  theme_minimal() +
  labs(title = "Distribution of Building Types", x = "Building Type", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

# Calculate the average price for each building type
average_price_by_type <- czyste %>%
  group_by(type) %>%
  summarise(avg_price = mean(price, na.rm = TRUE))


```

Bloki mieszkalne dominują w 62,5%, budynki mieszkalne stanowią 20,2%, a kamienice 17,3%. Znaczna liczba kamienic, które zazwyczaj są małe i niezbyt wysokie, w dużym stopniu przyczynia się do tego, że apartamenty w populacji znajdują się zazwyczaj na niższych piętrach.

##### Następnie tworzony jest wykres, który pokazuje wpływ piętra na cenę.

```{r}
# Create scatter plot with a linear trend line
ggplot(czyste, aes(x = floor, y = price)) +
  geom_point(alpha = 0.5, color = "blue") +  # Scatter plot points
  geom_smooth(method = "lm", color = "red", se = FALSE) +  # Linear trend line
  labs(
    title = "Price vs. Floor",
    x = "Floor",
    y = "Price (PLN)"
  ) +
  theme_minimal()
```

Wykres pokazuje stosunkowo nieistotną i słabą dodatnią korelację między ceną a piętrem. Sugeruje to, że piętro, na którym znajduje się apartament, nie wpływa znacząco na jego cenę.

Następnie analizowane są materiały budowlane i infrastruktura bezpieczeństwa w celu określenia ich wpływu na cenę budynku.

```{r}
ggplot(czyste, aes(x = buildingMaterial, y = price, fill = buildingMaterial)) +
  geom_boxplot(alpha = 0.8) +
  theme_minimal() +
  coord_flip() +
  labs(title = "Impact of Building Material on Price", x = "Building Material", y = "Price") 

#Impact of Security on Apartment Prices
ggplot(czyste, aes(x = factor(hasSecurity, labels = c("No Security", "Has Security")), y = price)) +
  geom_boxplot(aes(fill = factor(hasSecurity)), alpha = 0.8) +
  theme_minimal() +
  labs(title = "Impact of Security on Apartment Prices", x = "Security", y = "Price") +
  scale_fill_manual(values = c("red", "green"))


```

Dane pokazują, że ogólnie apartamenty zbudowane z cegły są droższe niż te wykonane z betonu, a apartamenty z ochroną są droższe niż te bez ochrony. Jednak w obu przypadkach istnieje wiele odstających wartości w populacji, co oznacza, że nie ma silnej korelacji między tymi dwoma czynnikami. Ważne dla analizy jest jednak to, że gęstość odstających wartości dla apartamentów bez ochrony sugeruje, że istnieją bardzo drogie apartamenty, które nie mają ochrony.

```{r}
ggplot(czyste, aes(x = centreDistance, y = price)) +
  geom_point(aes(color = city), alpha = 0.5) +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  theme_minimal() +
  labs(title = "Effect of Distance from Center on Price", x = "Distance from City Center (km)", y = "Price") 

# Visualizations  
ggplot(czyste, aes(x = squareMeters, y = price)) +  
  geom_point(aes(color = city, shape = ownership), size = 2) +  
  theme_minimal()  

```

Pierwszy wykres pokazuje korelację między ceną a odległością od centrum miasta w różnych polskich miastach.

Druga wizualizacja przedstawia cenę w zależności od wielkości apartamentu, w zależności od typu własności i miasta, z którego pochodzi. Najistotniejszym wnioskiem jest wysoka cena apartamentów w Warszawie i niska cena apartamentów w Bydgoszczy. Najdroższe apartamenty w centrach miast znajdują się w polskiej stolicy, jak się spodziewano, jednak największe, najtańsze apartamenty znajdują się w wielu polskich miastach, z najbardziej zauważalnymi w Bydgoszczy, Katowicach i Łodzi.

------------------------------------------------------------------------

## Wyniki
##### Dane ogólne
Analiza polskiego rynku nieruchomości na podstawie danych z czerwca 2024 roku pokazuje, że większość polskich apartamentów, bo 77,1%, mieści się w przedziale cenowym od 250 000 do 1 000 000 PLN. Rozkład cen jest wyraźnie przesunięty w prawo, co wskazuje na dużą liczbę apartamentów o wysokiej cenie. Ponad 13% nieruchomości przekracza cenę 1 250 000 PLN, co potwierdza obecność nieruchomości luksusowych.

##### Miasto, w którym znajduje się apartament, jest najważniejszym czynnikiem wpływającym na jego cenę
Wykresy pudełkowe pokazują znaczną zmienność cen między miastami. Stan apartamentu nie wpływa silnie na cenę, co pokazuje wykres skrzypcowy. Analiza ANOVA ceny według miasta i stanu potwierdza, że różnice cenowe zależą bardziej od miasta niż od stanu technicznego apartamentu.

##### Odległość od miasta
Negatywna korelacja między ceną a odległością od klinik/restauracji sugeruje, że apartamenty o wysokiej wartości znajdują się w rejonach o lepszej infrastrukturze miejskiej. Nieoczekiwany wynik: Apartamenty oddalone od centrum są droższe, co może wynikać z obecności luksusowych nieruchomości podmiejskich w zamkniętych osiedlach. Zbiór danych może być zniekształcony przez luksusowe inwestycje podmiejskie, a nie tradycyjne miejskie apartamenty.

### Ostateczne wnioski
Polski rynek nieruchomości zdominowany jest przez apartamenty w średnim przedziale cenowym (500 000 - 999 999 PLN). W rynku luksusowym występują wartości odstające, które znacząco wpływają na miary statystyczne. Przewagę ma własność prywatna (prawie 90%), a spółdzielcze mieszkania stanowią niewielki odsetek. Stan apartamentu ma niewielki wpływ na cenę, co sugeruje, że bardziej liczy się lokalizacja. Bliskość do klinik i restauracji ma pozytywny związek z ceną, podczas gdy odległość od centrum miasta wykazuje nieoczekiwaną negatywną korelację. Nieoczekiwany efekt odległości od centrum sugeruje, że drogie nieruchomości mogą być skoncentrowane w podmiejskich, luksusowych inwestycjach, a nie w tradycyjnych centrach miast.

## Źródła
```{r}
citation("ggstatsplot")
  
```
